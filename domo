FROM golang:1.24-alpine

RUN apk update && apk add --no-cache git bash

RUN go install github.com/githubnemo/CompileDaemon@latest

WORKDIR /app

# Hanya copy go.mod dan go.sum untuk download dependencies
COPY go.mod go.sum ./

RUN go mod download

EXPOSE 6060

ENV PATH=$PATH:/go/bin

# Default command (akan di-override oleh docker-compose.yml)
CMD ["CompileDaemon", "--build=go build -o app cmd/main.go", "--command=./app", "--directory=.", "--polling"]